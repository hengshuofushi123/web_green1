{% extends 'dashboard_base.html' %}
{% block page_title %}数据更新管理{% endblock %}
{% block content %}
<style>
  /* 正常样式 - 默认样式 */
  td.normal-status {
    background-color: #d4edda !important;
    color: #155724 !important;
  }
  
  /* 轻度异常样式 - 黄色背景 */
  td.mild-warning {
    background-color: #fff3cd !important;
    color: #856404 !important;
    font-weight: bold !important;
  }
  
  /* 警告样式 - 红色背景 */
  td.severe-warning {
    background-color: #f8d7da !important;
    color: #721c24 !important;
    font-weight: bold !important;
    border: 2px solid #f5c6cb !important;
  }
  
  /* 表格样式 - 表头冻结 */
  .table-nowrap th {
    position: sticky;
    top: 0;
    z-index: 10;
    background-color: white;
    border-bottom: 2px solid #dee2e6;
    box-shadow: 0 1px 0 rgba(0,0,0,0.1);
  }
  
  /* 防止水平滚动条 */
  .table-nowrap {
    table-layout: fixed;
    width: 100%;
  }
  
  .table-nowrap td {
    white-space: normal;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }
</style>
<div class="container-fluid py-2">
  <!-- 二级单位选择 -->
  <div class="row mb-3">
    <div class="col-md-4">
      <div class="d-flex align-items-center">
        <label class="form-label me-2 mb-0" style="min-width: 100px;">二级单位：</label>
        <select class="form-select" id="secondary-unit-select" onchange="changeSecondaryUnit(this.value)">
          {% for unit in secondary_units %}
          <option value="{{ unit }}" {% if unit == selected_unit %}selected{% endif %}>{{ unit }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
  </div>
  
  <div class="row">
    <!-- 数据表 -->
    <div class="col">
      <div class="card d-flex flex-column" style="height: calc(100vh - 160px);">
        <div class="card-header bg-primary text-white">
          <h5 class="card-title mb-0">数据提交时间</h5>
        </div>
        <div class="card-body position-relative" style="flex-grow: 1; overflow-y: auto; background-color: white;">
          <div class="table-responsive" style="overflow-y: auto; overflow-x: hidden; max-height: calc(100vh - 250px);">
            <table class="table table-sm table-striped table-nowrap w-100">
              <thead>
                <tr>
                  <th style="width: 40%">项目名称</th>
                  <th style="width: 15%">能源局核发平台</th>
                  <th style="width: 15%">绿证交易平台</th>
                  <th style="width: 15%">北京电力交易中心</th>
                  <th style="width: 15%">广州电力交易中心</th>
                </tr>
              </thead>
              <tbody>
                {% for proj in data %}
                <tr>
                  <td>{{ proj.project_name }}</td>
                  <td class="{{ proj.data_nyj_status }}" style="padding: 8px;">{{ proj.data_nyj_updated_at }}</td>
                  <td class="{{ proj.data_lzy_status }}" style="padding: 8px;">{{ proj.data_lzy_updated_at }}</td>
                  <td class="{{ proj.data_bjdl_status }}" style="padding: 8px;">{{ proj.data_bjdl_display }}</td>
                  <td class="{{ proj.data_gjdl_status }}" style="padding: 8px;">{{ proj.data_gjdl_display }}</td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="text-center text-muted">暂无数据</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// 二级单位切换函数
function changeSecondaryUnit(unit) {
  window.location.href = "{{ url_for('dashboard.data_submission_time', secondary_unit='__unit__') }}".replace('__unit__', unit);
}
</script>
{% endblock %}